{"version":3,"sources":["webpack:///webpack/bootstrap 3788b37ab20e359e62de","webpack:///external \"express\"","webpack:///external \"mongoose\"","webpack:///./src/index.js","webpack:///external \"dotenv/config\"","webpack:///external \"path\"","webpack:///./src/routes/index.js","webpack:///./src/routes/books.js","webpack:///./src/models/book.js","webpack:///external \"multer\"","webpack:///./src/routes/user.js","webpack:///./src/models/user.js","webpack:///external \"bcrypt\""],"names":["app","express","mongoose","connect","db","connection","on","console","error","bind","once","log","PORT","process","env","set","path","join","__dirname","use","static","urlencoded","extended","listen","indexRouter","Router","get","req","res","send","booksRouter","storage","multer","diskStorage","destination","file","cb","filename","Date","now","originalname","upload","single","Book","find","err","books","render","post","datas","body","newBook","save","book","redirect","Schema","bookSchema","title","type","String","trim","author","years","default","description","img","model","adminRouter","next","email","password","User","authenticate","user","Error","status","newUser","userSchema","username","name","statics","findOne","exec","bcrypt","compare","result","pre","hash"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 3788b37ab20e359e62de","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 0\n// module chunks = 0","module.exports = require(\"mongoose\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mongoose\"\n// module id = 1\n// module chunks = 0","import express from 'express'\nimport \"dotenv/config\"\nimport mongoose from 'mongoose'\nimport path from 'path'\nimport { indexRouter } from './routes/index'\nimport { booksRouter } from './routes/books'\nimport { adminRouter } from './routes/user'\n\n\nconst app = express()\n\nmongoose.connect('mongodb://localhost/bookstraining_db');\nconst db = mongoose.connection;\ndb.on('error', console.error.bind(console, 'connection error:'));\ndb.once('open', function() {\n  console.log('express pompeleupe')\n});\n\nconst { PORT } = process.env\n//initialisation de pug\napp.set('views', path.join(__dirname, 'views'))\napp.set('view engine', 'pug'); //voir doc express template engine\napp.use(express.static( path.join(__dirname, \"../public\")))\napp.use(express.urlencoded({extended:true}));\napp.use('/', indexRouter)\napp.use('/books', booksRouter)\napp.use('/admin', adminRouter)\n\napp.listen(PORT, () =>{\n  console.log(`Server on port ${ PORT }` );\n})\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","module.exports = require(\"dotenv/config\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"dotenv/config\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 5\n// module chunks = 0","import express from 'express'\nconst indexRouter = express.Router()\n\nindexRouter.get('/', (req, res) => {\n  res.send('ca fonctionne ')\n})\n\nexport { indexRouter }\n\n\n\n// WEBPACK FOOTER //\n// ./src/routes/index.js","import express from 'express'\nimport { Book } from '../models/book'\nconst booksRouter = express.Router()\n//doc multer\nimport multer from \"multer\"\nvar storage = multer.diskStorage({\n  destination: function (req, file, cb) {\n    cb(null, './public/uploads/')\n  },\n  filename: function (req, file, cb) {\n    cb(null, Date.now()+ '-' +file.originalname)\n  }\n})\n\nconst upload = multer({ storage: storage }).single(\"img\")\n\nbooksRouter.get('/', (req, res) => {\n  Book.find({}, (err, books)=> {\n    if(err) console.log(err)\n    res.render(\"allBook\", {\n      books\n    })\n  })\n})\n\nbooksRouter.get('/add_book', (req, res) => {\n  res.render('add_book')\n\n})\n\nbooksRouter.post('/add_book', upload, (req, res) => {\n  const datas = req.body\n  datas[\"img\"]= req.file.filename//recuperer la clef img dans l'objet datas(form)\n  const newBook = new Book(datas)\n  newBook.save((err, book) => {\n    if(err) res.send(err)\n    res.redirect(\"/books\")\n  })\n})\n\nexport { booksRouter }\n\n\n\n// WEBPACK FOOTER //\n// ./src/routes/books.js","import mongoose from 'mongoose'\n\n\nconst Schema = mongoose.Schema\n\nconst bookSchema = new Schema({\n  title:{type: String, trim:true},\n  author:{type: String, trim:true},\n  years:{type:Date, default:Date.now()},\n  description:{type: String},\n  img:{type: String}\n})\n\nconst Book = mongoose.model(\"Book\", bookSchema)\n\nexport { Book }\n\n\n\n// WEBPACK FOOTER //\n// ./src/models/book.js","module.exports = require(\"multer\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"multer\"\n// module id = 9\n// module chunks = 0","import express from 'express'\nimport { User } from '../models/user'\nconst adminRouter = express.Router()\n\nadminRouter.get('/login', (req, res) => {\n  res.render('login')\n})\nadminRouter.post('/login', (req,res, next) =>{\n  if(req.body.email && req.body.password){\n    User.authenticate(req.body.email, req.body.password, function(err, user){\n      if(err || !user){\n        var err = new Error(\"Email ou mot de passe introuvable\")\n        err.status = 401\n        return next(err)\n      } else{\n        return res.redirect('/')\n      }\n    })\n  }\n})\n\nadminRouter.get('/register', (req,res) =>{\n  res.render('register')\n})\n\nadminRouter.post('/register', (req,res, next) =>{\n  const newUser = new User(req.body)\n  newUser.save((err, user) =>{\n    if(err) res.send(err)\n    console.log(user);\n  })\n})\n\n\nexport { adminRouter }\n\n\n\n// WEBPACK FOOTER //\n// ./src/routes/user.js","import mongoose from 'mongoose'\nimport bcrypt from 'bcrypt'\n\nconst Schema = mongoose.Schema\n\nconst userSchema = new Schema({\n  username:{type: String, trim:true},\n  name:{type: String, trim:true},\n  email:{type:String},\n  password:{type: String}\n})\n\nuserSchema.statics.authenticate = function(email, password, cb){\n  User.findOne({email:email})\n    .exec(function(err, user){\n      if(err) {\n        return cb(err)\n      } else if (!user){\n        var error = new Error('Utilisateur introuvable')\n        error.status = 401;\n        return cb(error)\n      }\n      bcrypt.compare(password, user.password, function(error, result){\n        if(result === true){\n          return cb(null, user)\n        } else{\n          return cb()\n        }\n      })\n    })\n}\n\n// config bcrypt\nuserSchema.pre('save', function(next){ //voir doc node\n  const user = this //  this = chaque instance du model\n  bcrypt.hash(user.password, 10, function(error, hash){\n    if(error)return next(error)\n    user.password = hash\n    next()\n  })\n\n})\n\nconst User = mongoose.model(\"User\", userSchema)\n\nexport { User }\n\n\n\n// WEBPACK FOOTER //\n// ./src/models/user.js","module.exports = require(\"bcrypt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"bcrypt\"\n// module id = 12\n// module chunks = 0"],"sourceRoot":""}